---
import { NAV_ITEMS } from '@/constants/nav-items';
import ThemeToggle from './ThemeToggle.astro';
---

<header class="w-full px-4 font-inter font-medium py-4 fixed top-0 z-10">
  <div
    class="block md:flex justify-between items-center mx-auto lg:max-w-4xl md:max-w-3xl"
  >
    <h1 class="text-2xl hidden md:block">
      frontmario<span class="font-bold text-secondary">.dev</span>
    </h1>
    <nav class="flex items-center justify-between gap-0 md:gap-4 text-base">
      {
        NAV_ITEMS.map(item => (
          <a href={item.url} class={item.class} aria-label={item.title}>
            {item.title}
          </a>
        ))
      }
      <div class="md:hidden">
        <ThemeToggle />
      </div>
    </nav>
    <div class="hidden md:block">
      <ThemeToggle />
    </div>
  </div>
</header>

<style>
  header {
    animation: header-shadow 1s linear both;
    animation-timeline: scroll();
    animation-range: 0 200px;
  }

  @keyframes header-shadow {
    to {
      @apply shadow-md backdrop-blur-xl dark:bg-header-dark bg-header-light;
    }
  }
</style>

<script>
  const sections = document.querySelectorAll('section');
  const navItems = document.querySelectorAll('header nav a');

  const callback = (entries: IntersectionObserverEntry[]): void => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        navItems.forEach(item => {
          if (item.getAttribute('href') == `/#${entry.target.id}`) {
            item.classList.add('text-secondary');
          } else {
            item.classList.remove('text-secondary');
          }
        });
      }
    });
  };

  const observer = new IntersectionObserver(callback, {
    root: null,
    rootMargin: '0px',
    threshold: 0.3,
  });

  sections.forEach(section => {
    observer.observe(section);
  });

  // Cleanup function
  document.onvisibilitychange = () => {
    if (document.visibilityState === 'hidden') {
      observer.disconnect();
      return;
    }

    sections.forEach(section => {
      observer.observe(section);
    });
  };
</script>
